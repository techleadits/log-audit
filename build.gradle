plugins {
    id "java"
    id "maven"
    id "idea"
    id "com.moowork.node" version "1.2.0"
    id "com.moowork.gulp" version "1.2.0"
    id "com.github.dkorotych.gradle-maven-exec" version "1.2.2.1"
    id 'com.palantir.git-version' version '0.11.0'
}


apply from: 'gradle/build/node.gradle'

group = 'com.br'
version gitVersion()

description = "log-audit"

sourceCompatibility = 8
targetCompatibility = 8
tasks.withType(JavaCompile) {
	options.encoding = 'UTF-8'
}


repositories {
        
    maven { url "http://repo.maven.apache.org/maven2" }

    flatDir {
        dirs 'lib'
    }
}
dependencies {
    compile group: 'org.apache.commons', name: 'commons-io', version:'1.3.2'
    compile group: 'org.projectlombok', name: 'lombok', version:'1.16.22'
    
    compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version:'2.9.0'
    compile group: 'com.fasterxml.jackson.dataformat', name: 'jackson-dataformat-xml', version:'2.9.2'
    compile group: 'com.oracle', name: 'ojdbc6', version:'11.2.0.4'
    testCompile group: 'junit', name: 'junit', version:'4.12'

    //lombok é um processador de anotações, precisa estar declarado para ser compatível com gradle 5.0
    annotationProcessor('org.projectlombok:lombok:1.16.22')
    testAnnotationProcessor('org.projectlombok:lombok:1.16.22')
}

task mvn(type: MavenExec) {
    goals 'clean', 'package'
}

task jarb(type: Jar) {


    manifest {
        attributes 'Main-Class': 'LogFactory'
    }
    baseName = 'log-audit'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

task all{
    dependsOn 'jarb'
    dependsOn 'mvn'

    tasks.findByName('jarb').mustRunAfter 'mvn'
}

